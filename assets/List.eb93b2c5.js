import{d as f,a as O,D as P,_ as R,b as K,c as j,e as H,f as J,g as X,O as q}from"./DialogSfc.ed6fc101.js";import{_ as G,d as Q,r as u,o as W,c as Y,a as r,b as h,e as a,w as d,f as L,g as n,t as g,F as Z,h as ee,u as D,i as te,j as B,p as se,k as oe,l as ae}from"./index.cb3db58a.js";const ne=y=>(se("data-v-da181f84"),y=y(),oe(),y),le={class:"list"},ue=B(),ie={class:"modify-popup"},re={class:"btns"},de=B("\u53D6\u6D88"),ce=B("\u786E\u8BA4"),pe=ne(()=>n("div",{class:"divider"},null,-1)),ve={class:"content"},_e=["onClick"],me={class:"title"},fe={class:"info"},he={class:"left"},ge={class:"create-time"},ye={class:"size"},Fe={class:"progress"},we={key:0,class:"empty"},xe={key:1,class:"empty"},Se=Q({__name:"List",setup(y){const l=u([]);W(()=>{f.txtList.toArray().then(e=>l.value=e),localStorage.getItem("txt_reader_setting")||localStorage.setItem("txt_reader_setting",JSON.stringify(O))});const k={access:"\u6700\u540E\u9605\u8BFB\u65F6\u95F4",create:"\u6700\u540E\u6DFB\u52A0\u65F6\u95F4"},F=u("access"),A=u(!1),b=[{key:"access",name:k.access},{key:"create",name:k.create}],V=s=>{F.value=s.key},i=u(),C=u(!1),v=u(!1),I=[{key:"modify",name:"\u4FEE\u6539",handler:()=>{c.value=i.value.title,v.value=!0}},{key:"delete",name:"\u5220\u9664",handler:()=>{P(`\u662F\u5426\u5220\u9664\u3010${i.value.title}\u3011\uFF1F`).then(s=>{s==="confirm"&&(l.value=l.value.filter(e=>e.id!==i.value.id),f.txtList.delete(i.value.id))})}}],$=s=>{i.value=s,C.value=!0},c=u(""),U=()=>{f.txtList.update(i.value.id,{title:c.value}).then(()=>{l.value=l.value.map(s=>s.id===i.value.id?{...s,title:c.value}:s),c.value="",v.value=!1})},_=u(""),E=Y(()=>{const s=l.value.filter(e=>e.title.indexOf(_.value)!==-1);return F.value==="access"&&s.sort((e,o)=>o.accessTime-e.accessTime),F.value==="create"&&s.sort((e,o)=>o.createTime-e.createTime),s}),z=async s=>{const e=s.file;if(!e)return;const o=new FileReader;o.readAsArrayBuffer(e),o.addEventListener("load",()=>{const w=o.result,x=["utf-8","gbk","big5"],m=t=>{const p=new TextDecoder(t,{fatal:!0});try{return p.decode(w)}catch{return null}};let S="";for(const t of x){const p=m(t);if(p){S=p;break}}const T={id:""+new Date().getTime()+Math.floor(Math.random()*1e6),title:e.name,createTime:new Date().getTime(),accessTime:0,size:e.size,content:S,progress:0,progressText:""};l.value.push(T),f.txtList.add(T)})},M=s=>{const e=s/1024;return e<1024?`${e.toFixed(1)}KB`:`${(e/1024).toFixed(2)}MB`},N=s=>{const e=new Date().getTime();f.txtList.update(s.id,{accessTime:e}).then(()=>ae.push(s.id))};return(s,e)=>{const o=R,w=K,x=j,m=H,S=J,T=X;return r(),h("div",le,[a(w,{class:"search",placeholder:"\u641C\u7D22",modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),hint:!1},{"append-icon":d(()=>[_.value?(r(),L(o,{key:0,name:"window-close",onClick:e[0]||(e[0]=t=>_.value="")})):(r(),L(o,{key:1,name:"magnify"}))]),_:1},8,["modelValue"]),n("div",{class:"sort",onClick:e[2]||(e[2]=t=>A.value=!0)},[n("span",null,"\u6392\u5E8F\uFF1A"+g(k[F.value]),1),ue,a(o,{name:"chevron-down"})]),a(x,{title:"\u9009\u62E9\u6392\u5E8F\u65B9\u5F0F",actions:b,show:A.value,"onUpdate:show":e[3]||(e[3]=t=>A.value=t),onSelect:e[4]||(e[4]=t=>V(t))},null,8,["show"]),a(x,{title:"\u64CD\u4F5C",actions:I,show:C.value,"onUpdate:show":e[5]||(e[5]=t=>C.value=t),onSelect:e[6]||(e[6]=t=>t.handler())},null,8,["show"]),a(S,{show:v.value,"onUpdate:show":e[10]||(e[10]=t=>v.value=t)},{default:d(()=>[n("div",ie,[a(w,{hint:!1,placeholder:"\u8BF7\u8F93\u5165\u65B0\u6807\u9898",modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value=t)},null,8,["modelValue"]),n("div",re,[a(m,{text:"",type:"primary",onClick:e[8]||(e[8]=t=>v.value=!1)},{default:d(()=>[de]),_:1}),a(m,{text:"",type:"primary",onClick:e[9]||(e[9]=t=>U())},{default:d(()=>[ce]),_:1})])])]),_:1},8,["show"]),pe,n("div",ve,[(r(!0),h(Z,null,ee(D(E),t=>(r(),h("div",{class:"list-item",key:t.id,onClick:p=>N(t)},[a(D(q),{onTrigger:p=>$(t)},{default:d(()=>[n("div",me,g(t.title),1),n("div",fe,[n("div",he,[n("div",ge,g(new Date(t.createTime).toLocaleDateString()),1),n("div",ye,g(M(t.size)),1)]),n("div",Fe,g((t.progress*100).toFixed(2))+"%",1)])]),_:2},1032,["onTrigger"])],8,_e))),128)),l.value.length?D(E).length?te("",!0):(r(),h("div",xe,"\u641C\u7D22\u7ED3\u679C\u4E3A\u7A7A (\u2299\uFE4F\u2299)")):(r(),h("div",we,"\u4E66\u67B6\u7A7A\u7A7A\u5982\u4E5F \u2511(~\u0414 ~)\u250D"))]),a(T,{accept:"text/plain",onAfterRead:z},{default:d(()=>[a(m,{class:"upload-btn",type:"primary",round:""},{default:d(()=>[a(o,{name:"plus",size:28})]),_:1})]),_:1})])}}});var Ae=G(Se,[["__scopeId","data-v-da181f84"]]);export{Ae as default};
