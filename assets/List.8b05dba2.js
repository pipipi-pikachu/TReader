import{d as h,a as j,u as H,D as J,_ as R,b as X,c as q,e as G,f as Q,O as W}from"./DialogSfc.fe0ff52b.js";import{_ as Y,d as Z,r as i,o as ee,c as te,a as c,b as y,e as n,w as v,f as B,g as o,t as g,F as se,h as oe,u as k,i as ae,j as A,p as ne,k as le,l as ue}from"./index.c370612e.js";const ie=F=>(ne("data-v-6939ed1e"),F=F(),le(),F),re={class:"list"},ce=A(),de={class:"modify-popup"},pe={class:"btns"},ve=A("\u53D6\u6D88"),_e=A("\u786E\u8BA4"),me=ie(()=>o("div",{class:"divider"},null,-1)),fe={class:"content"},he=["onClick"],ye={class:"title"},ge={class:"info"},Fe={class:"left"},xe={class:"create-time"},we={class:"size"},Se={class:"progress"},Te={key:0,class:"empty"},ke={key:1,class:"empty"},Ae=Z({__name:"List",setup(F){const l=i([]);ee(()=>{h.txtList.toArray().then(e=>l.value=e),localStorage.getItem("txt_reader_setting")||localStorage.setItem("txt_reader_setting",JSON.stringify(j))});const w={access:"\u6700\u540E\u9605\u8BFB\u65F6\u95F4",create:"\u6700\u540E\u6DFB\u52A0\u65F6\u95F4"},x=i("access"),S=i(!1),E=[{key:"access",name:w.access},{key:"create",name:w.create}],L=s=>{x.value=s.key},r=i(),T=i(!1),_=i(!1),b=[{key:"modify",name:"\u4FEE\u6539",handler:()=>{d.value=r.value.title,_.value=!0}},{key:"delete",name:"\u5220\u9664",handler:()=>{J(`\u662F\u5426\u5220\u9664\u3010${r.value.title}\u3011\uFF1F`).then(s=>{s==="confirm"&&(l.value=l.value.filter(e=>e.id!==r.value.id),h.txtList.delete(r.value.id))})}}],V=s=>{r.value=s,T.value=!0},d=i(""),$=()=>{h.txtList.update(r.value.id,{title:d.value}).then(()=>{l.value=l.value.map(s=>s.id===r.value.id?{...s,title:d.value}:s),d.value="",_.value=!1})},m=i(""),C=te(()=>{const s=l.value.filter(e=>e.title.indexOf(m.value)!==-1);return x.value==="access"&&s.sort((e,a)=>a.accessTime-e.accessTime),x.value==="create"&&s.sort((e,a)=>a.createTime-e.createTime),s}),{data:D,fileName:I,fileSize:z,open:N}=H({dataType:"ArrayBuffer",types:[{description:"text",accept:{"text/plain":[".txt"]}}],excludeAcceptAllOption:!0}),M=async()=>{if(await N(),!D.value)return;const s=["utf-8","gbk","big5"],e=p=>{const u=new TextDecoder(p,{fatal:!0});try{return u.decode(D.value)}catch{return null}};let a="";for(const p of s){const u=e(p);if(u){a=u;break}}const f={id:""+new Date().getTime()+Math.floor(Math.random()*1e6),title:I.value,createTime:new Date().getTime(),accessTime:0,size:z.value,content:a,progress:0,progressText:""};l.value.push(f),h.txtList.add(f)},O=s=>{const e=s/1024;return e<1024?`${e.toFixed(1)}KB`:`${(e/1024).toFixed(2)}MB`},U=s=>{const e=new Date().getTime();h.txtList.update(s.id,{accessTime:e}).then(()=>ue.push(s.id))};return(s,e)=>{const a=R,f=X,p=q,u=G,P=Q;return c(),y("div",re,[n(f,{class:"search",placeholder:"\u641C\u7D22",modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),hint:!1},{"append-icon":v(()=>[m.value?(c(),B(a,{key:0,name:"window-close",onClick:e[0]||(e[0]=t=>m.value="")})):(c(),B(a,{key:1,name:"magnify"}))]),_:1},8,["modelValue"]),o("div",{class:"sort",onClick:e[2]||(e[2]=t=>S.value=!0)},[o("span",null,"\u6392\u5E8F\uFF1A"+g(w[x.value]),1),ce,n(a,{name:"chevron-down"})]),n(p,{title:"\u9009\u62E9\u6392\u5E8F\u65B9\u5F0F",actions:E,show:S.value,"onUpdate:show":e[3]||(e[3]=t=>S.value=t),onSelect:e[4]||(e[4]=t=>L(t))},null,8,["show"]),n(p,{title:"\u64CD\u4F5C",actions:b,show:T.value,"onUpdate:show":e[5]||(e[5]=t=>T.value=t),onSelect:e[6]||(e[6]=t=>t.handler())},null,8,["show"]),n(P,{show:_.value,"onUpdate:show":e[10]||(e[10]=t=>_.value=t)},{default:v(()=>[o("div",de,[n(f,{hint:!1,placeholder:"\u8BF7\u8F93\u5165\u65B0\u6807\u9898",modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=t=>d.value=t)},null,8,["modelValue"]),o("div",pe,[n(u,{text:"",type:"primary",onClick:e[8]||(e[8]=t=>_.value=!1)},{default:v(()=>[ve]),_:1}),n(u,{text:"",type:"primary",onClick:e[9]||(e[9]=t=>$())},{default:v(()=>[_e]),_:1})])])]),_:1},8,["show"]),me,o("div",fe,[(c(!0),y(se,null,oe(k(C),t=>(c(),y("div",{class:"list-item",key:t.id,onClick:K=>U(t)},[n(k(W),{onTrigger:K=>V(t)},{default:v(()=>[o("div",ye,g(t.title),1),o("div",ge,[o("div",Fe,[o("div",xe,g(new Date(t.createTime).toLocaleDateString()),1),o("div",we,g(O(t.size)),1)]),o("div",Se,g((t.progress*100).toFixed(2))+"%",1)])]),_:2},1032,["onTrigger"])],8,he))),128)),l.value.length?k(C).length?ae("",!0):(c(),y("div",ke,"\u641C\u7D22\u7ED3\u679C\u4E3A\u7A7A (\u2299\uFE4F\u2299)")):(c(),y("div",Te,"\u4E66\u67B6\u7A7A\u7A7A\u5982\u4E5F \u2511(~\u0414 ~)\u250D"))]),n(u,{class:"upload-btn",type:"primary",round:"",onClick:e[11]||(e[11]=t=>M())},{default:v(()=>[n(a,{name:"plus",size:28})]),_:1})])}}});var Be=Y(Ae,[["__scopeId","data-v-6939ed1e"]]);export{Be as default};
